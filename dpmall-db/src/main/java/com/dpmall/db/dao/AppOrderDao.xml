<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dpmall.db.dao.AppOrderDao">
	<resultMap id="AppOrderResultMap" type="com.dpmall.db.bean.OrderEntity">
	    <id property="id" column="PK" />
	    <result property="recommendStore" column="P_RECOMMENDSTORE" />
	    <result property="consignment" column="P_CONSIGNMENT" />
	    <result property="cusComment" column="P_CUSCOMMET"/>
	    <result property="serverComment" column="P_SERVERCOMMENT"/>
	    <result property="cusRefuseComment" column="P_CUSREFUSECOMMET"/>
	    <result property="agencyComment" column="P_AGENCYCOMMENT"/>
	    <result property="refuseType" column="P_REFUSETYPE"/>
	    <result property="refuseComment" column="P_REFUSECOMMENT"/>
	    <result property="acceptedRefuseComment" column="P_ACCEPTEDREFUSECOMMENT"/>
	    <result property="deliverPic" column="P_DELIVERYPIC"/>
	    <result property="status" column="P_STATUS"/>
	    <result property="acceptedBy" column="P_ACCEPTEDBY"/>
	    <result property="acceptedComment" column="P_ACCEPTEDCOMMENT"/>
	    <result property="acceptedTime" column="P_ACCEPTEDTIME"/>
	    <result property="isDeliverySelf" column="P_ISDELIVERYSELF"/>
	    <result property="deliveryTime" column="P_DELIVERYTIME"/>
	    <result property="finishTime" column="P_FINISHTIME"/>
	    <result property="deliveryPoint" column="deliveryPoint"/>
	    <result property="deliveryMode" column="deliveryMode"/>
	    <result property="orderCode" column="p_code"/>
	    <result property="address" column="p_streetname"/>
	    <result property="orderTotal" column="p_payamount"/>
	</resultMap>
	
	<select id="get2DistributeCount" resultType="java.lang.Integer">
		SELECT
			count(1)
			FROM
				O2OCONSIGNMENTITEMS o
				LEFT JOIN CONSIGNMENTS c ON o.P_CONSIGNMENT = c.PK			
				LEFT JOIN AGENCY A ON c.P_ALLOCATIONEMPLOYEECODE = A .p_uid
				WHERE
					A .PK = ${distributorId}
					AND o.P_STATUS='0'					
	</select>
	<select id="get2AcceptCount" resultType="int">
		select count(1) from O2OCONSIGNMENTITEMS  where P_STATUS='10'
		<if test="storeId != null">
		    and P_RECOMMENDSTORE=${storeId}
		</if>
	</select>
	<update id="distribute">
		update O2OCONSIGNMENTITEMS set 
			P_RECOMMENDSTORE=#{storeId},
			P_STATUS='10'
		where pk=#{orderCode}
	</update>
</mapper>