<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dpmall.db.dao.AppOrderDao">

	
	
	<resultMap type="com.dpmall.db.bean.OrderEntity" id="listResultMap">
		<id property="id" column="pk"/>
		<result property="consignment" column="p_code"/>
		<result property="status" column="P_STATUS"/>
		<result property="clientName" column="P_FIRSTNAME"/>
		<result property="clientTel" column="p_phone1"/>
		<result property="address" column="P_STREETNAME"/>
		<result property="deliveryPoint" column="P_DELIVERYPOINTOFSERVICE"/>
			<collection property="items" ofType="com.dpmall.db.bean.OrderItemEntity">
				<id property="id" column="itemsId"/>
			    <result property="splitOrderType" column="splitOrderType"/>
				<result property="packQua" column="packQua"/>
				<result property="code" column="code"/>
				<result property="name" column="name"/>
				<result property="description" column="description"/>
				<result property="category" column="category"/>
				<result property="unit" column="unit"/>
				<result property="netWeight" column="netWeight"/>
				<result property="volume" column="volume"/>
				<result property="size" column="size"/>
				<result property="quantity" column="quantity"/>
				<result property="tmallQuantity" column="tmallQuantity"/>
				<result property="basePrice" column="basePrice"/>
				<result property="totalPrice" column="totalPrice"/>
				<result property="deliveryCost" column="deliveryCost"/>
				<result property="promotionTotalsaved" column="promotionTotalsaved"/>
				<result property="payAmount" column="payAmount"/>
				<result property="juntanPrice" column="juntanPrice"/>
				<result property="serviceAmount" column="serviceAmount"/>
		    </collection>
	</resultMap>
		
	<select id="getOnePage4Distribute" resultMap="listResultMap">
		SELECT
			c.p_code,
			c.pk,
			c.P_DELIVERYPOINTOFSERVICE,
			o2.P_DELIVERYCOST AS deliveryCost,
			o2.P_SERVICEAMOUNT AS serviceAmount,
			o2.p_payamount AS payAmount,
			c.P_STATUS,
			o2.pk AS itemsId,
			A .P_STREETNAME,
			ROWNUM rn
		FROM
			CONSIGNMENTS c
		LEFT JOIN CONSIGNMENTENTRIES c2 ON c2.P_CONSIGNMENT = c.pk
		LEFT JOIN ORDERENTRIES o2 ON c2.P_ORDERENTRY = o2.pk
		LEFT JOIN ADDRESSES A ON c.P_SHIPPINGADDRESS = A .pk
		LEFT JOIN ENUMERATIONVALUES  E ON E.pk=c.p_status
		LEFT JOIN COMPOSEDTYPES c3 ON c3.pk=E.TYPEPKSTRING
		WHERE
			c3.INTERNALCODe = 'ConsignmentStatus' AND
			c.PK IN (
				SELECT
					pk
				FROM
					(
						SELECT
							pk,
							ROWNUM rn
						FROM
							CONSIGNMENTS
						WHERE
							P_ALLOCATIONEMPLOYEECODE = #{distributorId}
						AND ROWNUM &lt; ${offset}+${pageSize}+1
					) p1
				WHERE
					p1.rn &gt; ${offset}
			)
	</select>
	<select id="getOnePage4StoreId" resultMap="listResultMap">
		SELECT
			c.p_code,
			c.pk,
			c.P_DELIVERYPOINTOFSERVICE,
			o2.P_DELIVERYCOST AS deliveryCost,
			o2.P_SERVICEAMOUNT AS serviceAmount,
			o2.p_payamount AS payAmount,
			c.P_STATUS,
			o2.pk AS itemsId,
			A .P_STREETNAME,
			ROWNUM rn
		FROM
			CONSIGNMENTS c
		LEFT JOIN CONSIGNMENTENTRIES c2 ON c2.P_CONSIGNMENT = c.pk
		LEFT JOIN ORDERENTRIES o2 ON c2.P_ORDERENTRY = o2.pk
		LEFT JOIN ADDRESSES A ON c.P_SHIPPINGADDRESS = A .pk
		LEFT JOIN ENUMERATIONVALUES  E ON E.pk=c.p_status
		LEFT JOIN COMPOSEDTYPES c3 ON c3.pk=E.TYPEPKSTRING
		WHERE
			c3.INTERNALCODe = 'ConsignmentStatus' AND
			c.PK IN (
				SELECT
					pk
				FROM
					(
						SELECT
							pk,
							ROWNUM rn
						FROM
							CONSIGNMENTS
						WHERE
							P_DELIVERYPOINTOFSERVICE = #{storeId}
						AND ROWNUM &lt; ${offset}+${pageSize}+1
					) p1
				WHERE
					p1.rn &gt; ${offset}
			)
	</select>
	
</mapper>